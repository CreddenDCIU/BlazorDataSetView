@page "/"
@rendermode InteractiveServer

@using BlazorDataSetView;
@using BlazorDataSetView.Components
@using BlazorDataSetView.Interfaces
@using BlazorDataSetView.Providers
@using BlazorDataSetView.Enums
@using BlazorDataSetViewExamples.Records

<PageTitle>Home</PageTitle>

<h1>Hello, world!</h1>

@if (!FormInEditMode && _dsvComponent?.SingleRecordBeingEdited == null)
{
    <input type="button" value="Edit" @onclick="() => SwitchToEditMode()" />
}
else
{
    <input type="button" value="Save Changes" @onclick="() => SaveChanges()" />
}
<DataSetView @ref="_dsvComponent" DataSource="DataSource" DataSourceDefinition="DataSourceDefinition" FormInEditMode="FormInEditMode" Paginate="true" SingleRecordEdit="true"
    Selectable="false" SelectedRecords="[]" ShowSearch="true" SearchAsYouType="false" TEntity="ExampleReportRecord" OnRecordClicked="ExampleReportRecord_Clicked" />

Welcome to your new app.

@code {
    [Parameter]
    public List<ExampleReportRecord> DataSource { get; set; } = [];

    [Parameter]
    public ViewDefinition<ExampleReportRecord>? DataSourceDefinition { get; set; }

    [Parameter]
    public bool FormInEditMode { get; set; }

    private DataSetView<ExampleReportRecord>? _dsvComponent;

    protected override void OnInitialized()
    {
        DataSource = new List<ExampleReportRecord>()
        {
            new () { Id = 1, FirstName = "First", LastName = "Last", DateOfBirth = new DateTime(2020, 01, 01), RecordType = RecordType.None },
            new () { Id = 2, FirstName = "Christopher", LastName = "Redden", DateOfBirth = new DateTime(2000, 01, 01), RecordType = RecordType.None },
            new () { Id = 3, FirstName = "David", LastName = "O'Neill", DateOfBirth = new DateTime(1980, 01, 01), RecordType = RecordType.None },
            new () { Id = 4, FirstName = "Kathleen", LastName = "Thompson", DateOfBirth = new DateTime(1990, 01, 01), RecordType = RecordType.None },
            new () { Id = 5, FirstName = "Szilvia", LastName = "Mathe-Puckey", DateOfBirth = new DateTime(1990, 01, 01), RecordType = RecordType.None }
        };

        DataSourceDefinition = ViewDefinitionFactory.Create<ExampleReportRecord>(new Providers.ExampleReportViewDefinitionProvider());

        FormInEditMode = false;
    }

    public void ExampleReportRecord_Clicked(ExampleReportRecord record)
    {
        if (_dsvComponent == null) { return; }
        if (_dsvComponent.SingleRecordBeingEdited != null) { return; }

        _dsvComponent.SingleRecordBeingEdited = record;
    }

    public void SwitchToEditMode()
    {
        FormInEditMode = true;
    }

    public void SaveChanges()
    {
        FormInEditMode = false;

        if (_dsvComponent == null) { return; }
        _dsvComponent.SingleRecordBeingEdited = null;
    }
}
